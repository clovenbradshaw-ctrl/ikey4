<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Create your emergency medical QR code - no account needed, fully private">
    <title>Emergency QR - Your Medical ID</title>
    
    <!-- QR Code Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <!-- LZ-String Compression -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
            --radius: 12px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            background: white;
            border-radius: var(--radius);
            margin-bottom: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header p {
            color: var(--secondary);
        }

        .privacy-badge {
            background: var(--success);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
            margin-top: 15px;
        }

        /* Main Content Area */
        .main-content {
            background: white;
            border-radius: var(--radius);
            padding: 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Wizard Progress */
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }

        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 10%;
            right: 10%;
            height: 2px;
            background: var(--border);
            z-index: 0;
        }

        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 50%;
            margin: 0 auto 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .progress-step.active .progress-dot {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: scale(1.1);
        }

        .progress-step.completed .progress-dot {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .progress-label {
            font-size: 0.75rem;
            color: var(--secondary);
        }

        /* Wizard Steps */
        .wizard-step {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .wizard-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--secondary);
            margin-top: 5px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--light);
            color: var(--dark);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .wizard-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* Display View */
        .info-card {
            background: var(--light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .info-label {
            font-size: 0.85rem;
            color: var(--secondary);
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1rem;
            color: var(--dark);
            font-weight: 500;
        }

        /* QR Code Display */
        .qr-container {
            text-align: center;
            padding: 30px;
            background: white;
            border-radius: var(--radius);
            margin-top: 20px;
        }

        #qrcode {
            display: inline-block;
            padding: 20px;
            background: white;
            border: 2px solid var(--border);
            border-radius: 8px;
            margin: 20px 0;
        }

        .download-options {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Character Counter */
        .char-counter {
            text-align: right;
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .char-counter.good { color: var(--success); }
        .char-counter.warning { color: #f59e0b; }
        .char-counter.danger { color: var(--danger); }

        /* Loading State */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 640px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .wizard-progress {
                margin-bottom: 20px;
            }
            
            .progress-label {
                font-size: 0.65rem;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state h2 {
            color: var(--secondary);
            margin-bottom: 20px;
        }

        /* Success Animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: var(--success);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.3s ease;
        }

        @keyframes scaleIn {
            from { transform: scale(0); }
            to { transform: scale(1); }
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🚨 Emergency QR</h1>
            <p>Your medical information for emergencies</p>
            <div class="privacy-badge">🔒 100% Private - No data leaves your device</div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Wizard View -->
            <div id="wizard-view">
                <!-- Progress Bar -->
                <div class="wizard-progress">
                    <div class="progress-step active" data-step="1">
                        <div class="progress-dot">1</div>
                        <div class="progress-label">Welcome</div>
                    </div>
                    <div class="progress-step" data-step="2">
                        <div class="progress-dot">2</div>
                        <div class="progress-label">Basic Info</div>
                    </div>
                    <div class="progress-step" data-step="3">
                        <div class="progress-dot">3</div>
                        <div class="progress-label">Medical</div>
                    </div>
                    <div class="progress-step" data-step="4">
                        <div class="progress-dot">4</div>
                        <div class="progress-label">Contact</div>
                    </div>
                    <div class="progress-step" data-step="5">
                        <div class="progress-dot">5</div>
                        <div class="progress-label">Review</div>
                    </div>
                </div>

                <!-- Step 1: Welcome -->
                <div class="wizard-step active" data-step="1">
                    <h2>Create Your Emergency Medical ID</h2>
                    <p style="margin: 20px 0;">This tool creates a QR code containing your emergency medical information. First responders can scan it to instantly see:</p>
                    <ul style="margin-left: 20px; color: var(--secondary);">
                        <li>Your name and blood type</li>
                        <li>Critical allergies and medications</li>
                        <li>Medical conditions</li>
                        <li>Emergency contact information</li>
                    </ul>
                    <div style="background: #fef3c7; border: 1px solid #fbbf24; border-radius: 8px; padding: 15px; margin-top: 20px;">
                        <strong>⚡ How it works:</strong> Your information is compressed and stored directly in the QR code. No accounts, no passwords, no cloud storage - just instant access when seconds count.
                    </div>
                </div>

                <!-- Step 2: Basic Info -->
                <div class="wizard-step" data-step="2">
                    <h2>Basic Information</h2>
                    
                    <div class="form-group">
                        <label for="name">Full Name *</label>
                        <input type="text" id="name" placeholder="John Smith" required>
                    </div>

                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob">
                        <div class="form-help">Optional - helps with identification</div>
                    </div>

                    <div class="form-group">
                        <label for="blood">Blood Type</label>
                        <select id="blood">
                            <option value="">Unknown / Not Sure</option>
                            <option value="A+">A+</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B-">B-</option>
                            <option value="AB+">AB+</option>
                            <option value="AB-">AB-</option>
                            <option value="O+">O+</option>
                            <option value="O-">O-</option>
                        </select>
                    </div>
                </div>

                <!-- Step 3: Medical Info -->
                <div class="wizard-step" data-step="3">
                    <h2>Medical Information</h2>
                    <p style="margin-bottom: 20px; color: var(--secondary);">Keep entries brief - focus on critical information only</p>
                    
                    <div class="form-group">
                        <label for="allergies">Allergies</label>
                        <textarea id="allergies" placeholder="e.g., Penicillin, peanuts, latex"></textarea>
                        <div class="char-counter good" id="allergies-counter">0 / 200 characters</div>
                    </div>

                    <div class="form-group">
                        <label for="medications">Current Medications</label>
                        <textarea id="medications" placeholder="e.g., Metformin 500mg, Lisinopril 10mg"></textarea>
                        <div class="char-counter good" id="medications-counter">0 / 200 characters</div>
                    </div>

                    <div class="form-group">
                        <label for="conditions">Medical Conditions</label>
                        <textarea id="conditions" placeholder="e.g., Type 2 Diabetes, Hypertension"></textarea>
                        <div class="char-counter good" id="conditions-counter">0 / 200 characters</div>
                    </div>
                </div>

                <!-- Step 4: Emergency Contact -->
                <div class="wizard-step" data-step="4">
                    <h2>Emergency Contact</h2>
                    
                    <div class="form-group">
                        <label for="ec-name">Contact Name *</label>
                        <input type="text" id="ec-name" placeholder="Jane Smith" required>
                    </div>

                    <div class="form-group">
                        <label for="ec-phone">Phone Number *</label>
                        <input type="tel" id="ec-phone" placeholder="555-0123" required>
                    </div>

                    <div class="form-group">
                        <label for="ec-relationship">Relationship</label>
                        <select id="ec-relationship">
                            <option value="">Select...</option>
                            <option value="Spouse">Spouse/Partner</option>
                            <option value="Parent">Parent</option>
                            <option value="Child">Child</option>
                            <option value="Sibling">Sibling</option>
                            <option value="Friend">Friend</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <!-- Step 5: Review -->
                <div class="wizard-step" data-step="5">
                    <h2>Review Your Information</h2>
                    <div id="review-content"></div>
                    <div style="background: #dcfce7; border: 1px solid #86efac; border-radius: 8px; padding: 15px; margin-top: 20px;">
                        <strong>✅ Ready to Generate:</strong> Check your information above. You can always regenerate your QR code with updated information.
                    </div>
                </div>

                <!-- Wizard Actions -->
                <div class="wizard-actions">
                    <button class="btn btn-secondary" id="btn-back" onclick="previousStep()">← Back</button>
                    <button class="btn btn-primary" id="btn-next" onclick="nextStep()">Next →</button>
                    <button class="btn btn-success hidden" id="btn-generate" onclick="generateQR()">Generate QR Code</button>
                </div>
            </div>

            <!-- Display View (for existing data) -->
            <div id="display-view" class="hidden">
                <h2>Emergency Information</h2>
                <div id="display-content"></div>
                <div style="margin-top: 20px;">
                    <button class="btn btn-primary" onclick="editInfo()">✏️ Edit Information</button>
                </div>
            </div>

            <!-- QR Code View -->
            <div id="qr-view" class="hidden">
                <div class="success-checkmark">
                    <span style="color: white; font-size: 2rem;">✓</span>
                </div>
                <h2 style="text-align: center; margin-bottom: 20px;">Your Emergency QR Code is Ready!</h2>
                
                <div class="qr-container">
                    <div id="qrcode"></div>
                    
                    <div class="download-options">
                        <button class="btn btn-success" onclick="downloadQR('wallet')">📱 Wallet Size</button>
                        <button class="btn btn-success" onclick="downloadQR('full')">📄 Full Page</button>
                        <button class="btn btn-primary" onclick="copyURL()">📋 Copy Link</button>
                    </div>
                </div>

                <div style="margin-top: 30px; text-align: center;">
                    <button class="btn btn-secondary" onclick="startOver()">← Create Another</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentStep = 1;
        let formData = {};

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            // Check if there's data in the URL
            const urlData = getDataFromURL();
            if (urlData) {
                displayExistingData(urlData);
            } else {
                showWizard();
            }

            // Add character counters
            setupCharacterCounters();
        });

        // Character counter setup
        function setupCharacterCounters() {
            const fields = ['allergies', 'medications', 'conditions'];
            fields.forEach(field => {
                const textarea = document.getElementById(field);
                const counter = document.getElementById(`${field}-counter`);
                
                if (textarea && counter) {
                    textarea.addEventListener('input', () => {
                        const length = textarea.value.length;
                        counter.textContent = `${length} / 200 characters`;
                        
                        if (length <= 100) {
                            counter.className = 'char-counter good';
                        } else if (length <= 150) {
                            counter.className = 'char-counter warning';
                        } else {
                            counter.className = 'char-counter danger';
                        }
                    });
                }
            });
        }

        // Wizard navigation
        function showWizard() {
            document.getElementById('wizard-view').classList.remove('hidden');
            document.getElementById('display-view').classList.add('hidden');
            document.getElementById('qr-view').classList.add('hidden');
        }

        function nextStep() {
            if (validateStep(currentStep)) {
                if (currentStep === 4) {
                    showReview();
                }
                
                currentStep++;
                updateWizardDisplay();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateWizardDisplay();
            }
        }

        function updateWizardDisplay() {
            // Update progress dots
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 < currentStep) {
                    step.classList.add('completed');
                } else if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });

            // Show current step
            document.querySelectorAll('.wizard-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`.wizard-step[data-step="${currentStep}"]`).classList.add('active');

            // Update buttons
            document.getElementById('btn-back').style.display = currentStep === 1 ? 'none' : 'block';
            document.getElementById('btn-next').classList.toggle('hidden', currentStep === 5);
            document.getElementById('btn-generate').classList.toggle('hidden', currentStep !== 5);
        }

        function validateStep(step) {
            if (step === 2) {
                const name = document.getElementById('name').value.trim();
                if (!name) {
                    alert('Please enter your name');
                    return false;
                }
            }
            
            if (step === 4) {
                const ecName = document.getElementById('ec-name').value.trim();
                const ecPhone = document.getElementById('ec-phone').value.trim();
                if (!ecName || !ecPhone) {
                    alert('Please enter emergency contact name and phone');
                    return false;
                }
            }
            
            return true;
        }

        function showReview() {
            // Collect all form data
            formData = {
                v: 1,
                n: document.getElementById('name').value.trim(),
                d: document.getElementById('dob').value,
                b: document.getElementById('blood').value,
                a: document.getElementById('allergies').value.trim(),
                m: document.getElementById('medications').value.trim(),
                c: document.getElementById('conditions').value.trim(),
                ec: document.getElementById('ec-name').value.trim(),
                ep: document.getElementById('ec-phone').value.trim(),
                er: document.getElementById('ec-relationship').value
            };

            // Display review
            const reviewHTML = `
                <div class="info-card">
                    <div class="info-label">Name</div>
                    <div class="info-value">${formData.n || 'Not provided'}</div>
                </div>
                ${formData.d ? `
                <div class="info-card">
                    <div class="info-label">Date of Birth</div>
                    <div class="info-value">${new Date(formData.d).toLocaleDateString()}</div>
                </div>` : ''}
                ${formData.b ? `
                <div class="info-card">
                    <div class="info-label">Blood Type</div>
                    <div class="info-value">${formData.b}</div>
                </div>` : ''}
                ${formData.a ? `
                <div class="info-card">
                    <div class="info-label">Allergies</div>
                    <div class="info-value">${formData.a}</div>
                </div>` : ''}
                ${formData.m ? `
                <div class="info-card">
                    <div class="info-label">Medications</div>
                    <div class="info-value">${formData.m}</div>
                </div>` : ''}
                ${formData.c ? `
                <div class="info-card">
                    <div class="info-label">Medical Conditions</div>
                    <div class="info-value">${formData.c}</div>
                </div>` : ''}
                <div class="info-card">
                    <div class="info-label">Emergency Contact</div>
                    <div class="info-value">
                        ${formData.ec}<br>
                        📞 ${formData.ep}
                        ${formData.er ? `<br><small>${formData.er}</small>` : ''}
                    </div>
                </div>
            `;
            
            document.getElementById('review-content').innerHTML = reviewHTML;
        }

        function generateQR() {
            // Remove empty fields to save space
            const cleanData = {};
            Object.keys(formData).forEach(key => {
                if (formData[key]) {
                    cleanData[key] = formData[key];
                }
            });

            // Compress and encode
            const jsonStr = JSON.stringify(cleanData);
            const compressed = LZString.compressToEncodedURIComponent(jsonStr);
            
            // Create URL
            const url = `${window.location.origin}${window.location.pathname}#${compressed}`;
            
            // Update browser URL
            window.history.replaceState(null, '', url);
            
            // Show QR view
            document.getElementById('wizard-view').classList.add('hidden');
            document.getElementById('qr-view').classList.remove('hidden');
            
            // Generate QR code
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById('qrcode'), {
                text: url,
                width: 256,
                height: 256,
                colorDark: '#000000',
                colorLight: '#ffffff',
                correctLevel: QRCode.CorrectLevel.M
            });
        }

        function downloadQR(size) {
            const canvas = document.querySelector('#qrcode canvas');
            if (!canvas) return;

            if (size === 'wallet') {
                // Create smaller version for wallet
                const walletCanvas = document.createElement('canvas');
                walletCanvas.width = 400;
                walletCanvas.height = 250;
                const ctx = walletCanvas.getContext('2d');
                
                // White background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, 400, 250);
                
                // Draw QR code
                ctx.drawImage(canvas, 10, 10, 150, 150);
                
                // Add text
                ctx.fillStyle = 'black';
                ctx.font = 'bold 16px Arial';
                ctx.fillText('EMERGENCY MEDICAL ID', 170, 30);
                ctx.font = '12px Arial';
                ctx.fillText(`Name: ${formData.n}`, 170, 60);
                ctx.fillText('Scan for full medical info', 170, 90);
                ctx.fillText('In emergency, scan QR code', 170, 120);
                
                // Download
                const link = document.createElement('a');
                link.download = 'emergency-qr-wallet.png';
                link.href = walletCanvas.toDataURL();
                link.click();
            } else {
                // Full size download
                const link = document.createElement('a');
                link.download = 'emergency-qr-full.png';
                link.href = canvas.toDataURL();
                link.click();
            }
        }

        function copyURL() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                alert('Link copied to clipboard!');
            });
        }

        function getDataFromURL() {
            const hash = window.location.hash.slice(1);
            if (!hash) return null;
            
            try {
                const decompressed = LZString.decompressFromEncodedURIComponent(hash);
                return JSON.parse(decompressed);
            } catch (e) {
                console.error('Failed to parse URL data:', e);
                return null;
            }
        }

        function displayExistingData(data) {
            document.getElementById('wizard-view').classList.add('hidden');
            document.getElementById('display-view').classList.remove('hidden');
            
            let html = '';
            
            if (data.n) {
                html += `<div class="info-card">
                    <div class="info-label">Name</div>
                    <div class="info-value">${data.n}</div>
                </div>`;
            }
            
            if (data.d) {
                html += `<div class="info-card">
                    <div class="info-label">Date of Birth</div>
                    <div class="info-value">${new Date(data.d).toLocaleDateString()}</div>
                </div>`;
            }
            
            if (data.b) {
                html += `<div class="info-card">
                    <div class="info-label">Blood Type</div>
                    <div class="info-value">${data.b}</div>
                </div>`;
            }
            
            if (data.a) {
                html += `<div class="info-card">
                    <div class="info-label">Allergies</div>
                    <div class="info-value">${data.a}</div>
                </div>`;
            }
            
            if (data.m) {
                html += `<div class="info-card">
                    <div class="info-label">Medications</div>
                    <div class="info-value">${data.m}</div>
                </div>`;
            }
            
            if (data.c) {
                html += `<div class="info-card">
                    <div class="info-label">Medical Conditions</div>
                    <div class="info-value">${data.c}</div>
                </div>`;
            }
            
            if (data.ec) {
                html += `<div class="info-card">
                    <div class="info-label">Emergency Contact</div>
                    <div class="info-value">
                        ${data.ec}<br>
                        📞 ${data.ep}
                        ${data.er ? `<br><small>${data.er}</small>` : ''}
                    </div>
                </div>`;
            }
            
            document.getElementById('display-content').innerHTML = html;
        }

        function editInfo() {
            const data = getDataFromURL();
            if (data) {
                // Pre-fill form with existing data
                if (data.n) document.getElementById('name').value = data.n;
                if (data.d) document.getElementById('dob').value = data.d;
                if (data.b) document.getElementById('blood').value = data.b;
                if (data.a) document.getElementById('allergies').value = data.a;
                if (data.m) document.getElementById('medications').value = data.m;
                if (data.c) document.getElementById('conditions').value = data.c;
                if (data.ec) document.getElementById('ec-name').value = data.ec;
                if (data.ep) document.getElementById('ec-phone').value = data.ep;
                if (data.er) document.getElementById('ec-relationship').value = data.er;
            }
            
            currentStep = 1;
            showWizard();
            updateWizardDisplay();
        }

        function startOver() {
            // Clear form
            document.getElementById('name').value = '';
            document.getElementById('dob').value = '';
            document.getElementById('blood').value = '';
            document.getElementById('allergies').value = '';
            document.getElementById('medications').value = '';
            document.getElementById('conditions').value = '';
            document.getElementById('ec-name').value = '';
            document.getElementById('ec-phone').value = '';
            document.getElementById('ec-relationship').value = '';
            
            // Clear URL
            window.history.replaceState(null, '', window.location.pathname);
            
            // Reset wizard
            currentStep = 1;
            showWizard();
            updateWizardDisplay();
        }
    </script>
</body>
</html>
