<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="faq.title">iKey Personal Hub - FAQ</title>
    <script src="scripts/translate.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f8fafc;
            min-height: 100vh;
            padding: 20px;
        }

        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #fff;
            color: #000;
            padding: 8px 16px;
            z-index: 1000;
        }

        .skip-link:focus {
            top: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: #374151;
            margin-bottom: 30px;
            animation: fadeInDown 0.8s ease;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .security-tiers {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
            animation: fadeIn 0.8s ease;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }

        .tier-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .tier-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .tier-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .tier-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }

        .tier-desc {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }

        .search-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            animation: fadeInUp 0.8s ease;
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.1rem;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .suggestions {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .suggestion-chip {
            padding: 8px 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            border: none;
            animation: slideIn 0.3s ease;
        }

        .suggestion-chip:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            animation: fadeIn 1s ease;
        }

        .stat-item {
            background: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 25px;
            animation: fadeIn 1s ease;
        }

        .category-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }

        .category-card.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .category-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .category-name {
            font-weight: 600;
            font-size: 0.9rem;
        }

        .faq-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            max-height: 700px;
            overflow-y: auto;
            animation: fadeInUp 0.8s ease;
        }

        .faq-item {
            margin-bottom: 20px;
            padding: 0;
            background: white;
            border-radius: 16px;
            transition: all 0.3s ease;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border: 2px solid #f0f2ff;
            overflow: hidden;
        }

        .faq-item:hover {
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
            border-color: #667eea;
            transform: translateY(-3px);
        }

        .faq-item.highlighted {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            border-color: #764ba2;
            box-shadow: 0 8px 25px rgba(118, 75, 162, 0.2);
            animation: pulse 0.5s ease;
        }

        .faq-header {
            padding: 25px 30px;
            background: linear-gradient(135deg, #f8f9fa, #f0f2ff);
            position: relative;
            transition: background 0.3s ease;
        }

        .faq-item:hover .faq-header {
            background: linear-gradient(135deg, #f0f2ff, #e8ecff);
        }

        .faq-item.highlighted .faq-header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
        }

        .faq-question {
            font-weight: 600;
            color: #2d3748;
            font-size: 1.15rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            line-height: 1.4;
            padding-right: 40px;
        }

        .faq-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: white;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .category-badge-icon {
            font-size: 1rem;
        }

        .faq-answer {
            color: #4a5568;
            line-height: 1.8;
            font-size: 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: white;
        }

        .faq-answer-content {
            padding: 0 30px 25px 30px;
        }

        .faq-answer.open {
            max-height: 800px;
        }

        .expand-icon {
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: #667eea;
            font-size: 1.2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .expand-icon:hover {
            background: #667eea;
            color: white;
            transform: translateY(-50%) scale(1.1);
        }

        .expand-icon.open {
            transform: translateY(-50%) rotate(180deg);
        }

        .expand-icon.open:hover {
            transform: translateY(-50%) rotate(180deg) scale(1.1);
        }

        .match-score {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .answer-highlight {
            background: linear-gradient(90deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .code-block {
            background: #f4f4f4;
            border-left: 3px solid #667eea;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.1rem;
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8rem; }
            .categories-grid { grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); }
            .category-card { padding: 12px; }
            .category-icon { font-size: 1.5rem; }
        .stats { flex-direction: column; gap: 15px; }
        .faq-question { font-size: 1rem; }
        .expand-icon { right: 15px; }
        .faq-header { padding: 20px; }
        .faq-answer-content { padding: 0 20px 20px 20px; }
        .security-tiers { grid-template-columns: 1fr; }
    }

        .info-icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            margin-left: 4px;
            background: url('https://storage.googleapis.com/art_homelessness/tool%20tip%20question%20mark.png') no-repeat center/contain;
            cursor: pointer;
            position: relative;
            font-size: 0;
        }

        .info-icon::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: 125%;
            background: #1e293b;
            color: white;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.85rem;
            white-space: normal;
            width: 200px;
            max-width: 250px;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .info-icon:hover::after,
        .info-icon:focus::after {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link" data-i18n="accessibility.skipToContent">Skip to main content</a>
    <div class="container">
        <header class="header">
            <h1 data-i18n="faq.header">🔐 iKey Personal Hub FAQ</h1>
            <p data-i18n="faq.description">A safe place for files and quick links. It offers an optional emergency QR.</p>
        </header>

        <main id="main-content">
        <div class="security-tiers">
            <div class="tier-card">
                <div class="tier-icon">🔓</div>
                <div class="tier-name" data-i18n="faq.publicTier">Public Tier <span class="info-icon" tabindex="0" data-tooltip="Basic emergency details anyone can read from your QR code.">ℹ️</span></div>
                <div class="tier-desc" data-i18n="faq.publicDesc">Emergency info accessible via QR code - contact details and critical information without password</div>
            </div>
            <div class="tier-card">
                <div class="tier-icon">🔐</div>
                <div class="tier-name" data-i18n="faq.protectedTier">Password-Protected Tier <span class="info-icon" tabindex="0" data-tooltip="Encrypted with your password; iKey never uploads this content.">ℹ️</span></div>
                <div class="tier-desc" data-i18n="faq.protectedDesc">Your personal files, documents, and sensitive information - secured with encryption</div>
            </div>
        </div>

        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalQuestions">0</div>
                <div class="stat-label" data-i18n="faq.totalQuestions">Total Questions</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="matchedResults">0</div>
                <div class="stat-label" data-i18n="faq.matchedResults">Matched Results</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="selectedCategory" data-i18n="faq.allTopics">All Topics</div>
                <div class="stat-label" data-i18n="faq.selected">Selected</div>
            </div>
        </div>

        <div class="search-container">
            <input type="text" 
                   class="search-input" 
                   id="searchInput" 
                   placeholder="Type your question (e.g., 'bookmarks', 'proton apps', 'QR code', 'encryption')" data-i18n-placeholder="faq.searchPlaceholder">
            <div class="suggestions" id="suggestions"></div>
        </div>

        <div class="categories-grid" id="categoriesGrid"></div>

            <div class="faq-container" id="faqContainer">
            <div class="no-results" data-i18n="faq.startTyping">Start typing to search or select a category above</div>
        </div>
        </main>
    </div>

    <script>
        // Complete FAQ Database for iKey Personal Hub
        const faqData = [
    { category: 'Getting Started', question: 'What is iKey?', answer: 'iKey is a safe place for your files and quick links. It runs in your browser and keeps your info private.', keywords: ['what', 'ikey'] },
    { category: 'Getting Started', question: 'How do I start?', answer: 'Open the app. Add your info if you want, set a strong password, and pick your shortcuts.', keywords: ['start', 'setup'] },
    { category: 'Security', question: 'What are the two security levels?', answer: 'Public lets you share basic info without a password. Private locks the rest with your password.', keywords: ['security', 'tier'] },
    { category: 'Security', question: 'Do I need an account?', answer: 'No. You can use iKey without any account. You may make a free Proton account for extra tools.', keywords: ['account'] },
    { category: 'Bookmarks', question: 'How do bookmarks work?', answer: 'The home screen shows a grid of links. Tap to open or hold to edit.', keywords: ['bookmark'] },
    { category: 'Privacy', question: 'Does iKey track me?', answer: 'No. iKey keeps all data on your device and sends nothing to us.', keywords: ['privacy', 'tracking'] },
    { category: 'Password', question: 'What if I forget my password?', answer: 'We cannot recover it. Write it down or keep the recovery file safe.', keywords: ['password'] },
    { category: 'Storage', question: 'Where is my data stored?', answer: 'Your data lives in your browser. You can also save an encrypted copy in the cloud.', keywords: ['storage'] },
    { category: 'QR Code', question: 'Do I need the QR code?', answer: 'No. It is optional. Use it if you want to share basic info fast.', keywords: ['qr'] },
    { category: 'Help', question: 'Who can see my info?', answer: 'Only you or people you share your password with.', keywords: ['access'] }
];

        // Rest of the JavaScript code remains the same...
        // Fuzzy string matching function
        function fuzzyMatch(text, query) {
            text = text.toLowerCase();
            query = query.toLowerCase();
            
            // Exact match gets highest score
            if (text.includes(query)) return 1.0;
            
            // Word-by-word matching
            const queryWords = query.split(/\s+/);
            const textWords = text.split(/\s+/);
            let matchCount = 0;
            
            for (const qWord of queryWords) {
                for (const tWord of textWords) {
                    if (tWord.includes(qWord) || qWord.includes(tWord)) {
                        matchCount++;
                        break;
                    }
                }
            }
            
            if (matchCount > 0) {
                return matchCount / queryWords.length * 0.8;
            }
            
            // Character-level fuzzy matching
            let score = 0;
            let lastIndex = -1;
            
            for (const char of query) {
                const index = text.indexOf(char, lastIndex + 1);
                if (index > -1) {
                    score++;
                    lastIndex = index;
                }
            }
            
            return (score / query.length) * 0.5;
        }

        // Search function
        function searchFAQ(query, selectedCategory = null) {
            if (!query || query.length < 2) return [];
            
            const results = faqData
                .filter(item => !selectedCategory || item.category === selectedCategory)
                .map(item => {
                    // Calculate match scores
                    const questionScore = fuzzyMatch(item.question, query) * 1.5;
                    const keywordScore = Math.max(...item.keywords.map(k => fuzzyMatch(k, query))) * 2;
                    const answerScore = fuzzyMatch(item.answer, query) * 0.8;
                    const categoryScore = fuzzyMatch(item.category, query) * 0.5;
                    
                    const totalScore = Math.max(questionScore, keywordScore, answerScore, categoryScore);
                    
                    return { ...item, score: totalScore };
                })
                .filter(item => item.score > 0.3)
                .sort((a, b) => b.score - a.score)
                .slice(0, 15);
            
            return results;
        }

        // Initialize categories
        const categories = [
            { key: 'gettingStarted', name: 'Getting Started', icon: '🚀' },
            { key: 'bookmarks', name: 'Bookmarks', icon: '🔖' },
            { key: 'protonSuite', name: 'Proton Suite', icon: '🔐' },
            { key: 'security', name: 'Security', icon: '🔒' },
            { key: 'qrCode', name: 'QR Code', icon: '📱' },
            { key: 'password', name: 'Password', icon: '🔑' },
            { key: 'storage', name: 'Storage', icon: '💾' },
            { key: 'privacy', name: 'Privacy', icon: '🛡️' },
            { key: 'technical', name: 'Technical', icon: '⚙️' },
            { key: 'troubleshooting', name: 'Troubleshooting', icon: '🔧' },
            { key: 'bestPractices', name: 'Best Practices', icon: '✅' }
        ];

        let selectedCategory = null;
        let currentResults = [];

        // Common search suggestions
        const suggestions = [
            { key: 'bookmarkSystem', text: 'bookmark system' },
            { key: 'protonApps', text: 'proton apps' },
            { key: 'contactShortcuts', text: 'contact shortcuts' },
            { key: 'encryption', text: 'encryption' },
            { key: 'cloudBackup', text: 'cloud backup' },
            { key: 'qrCode', text: 'QR code' },
            { key: 'passwordTips', text: 'password tips' },
            { key: 'selfHost', text: 'self-host' }
        ];

        // Render categories grid
        function renderCategories() {
            const grid = document.getElementById('categoriesGrid');
            grid.innerHTML = categories.map(cat => `
                <div class="category-card" data-category="${cat.name}" data-key="${cat.key}">
                    <div class="category-icon">${cat.icon}</div>
                    <div class="category-name" data-i18n="faq.categories.${cat.key}">${cat.name}</div>
                </div>
            `).join('');
            
            // Add click handlers
            grid.querySelectorAll('.category-card').forEach(card => {
                card.addEventListener('click', () => {
                    if (card.classList.contains('active')) {
                        card.classList.remove('active');
                        selectedCategory = null;
                        document.getElementById('selectedCategory').textContent = t('faq.allTopics', 'All Topics');
                        document.getElementById('selectedCategory').setAttribute('data-i18n', 'faq.allTopics');
                    } else {
                        grid.querySelectorAll('.category-card').forEach(c => c.classList.remove('active'));
                        card.classList.add('active');
                        selectedCategory = card.dataset.category;
                        document.getElementById('selectedCategory').textContent = t(`faq.categories.${card.dataset.key}`, selectedCategory);
                        document.getElementById('selectedCategory').setAttribute('data-i18n', `faq.categories.${card.dataset.key}`);
                    }

                    // Re-run search if there's a query
                    const query = document.getElementById('searchInput').value;
                    if (query) {
                        performSearch(query);
                    } else {
                        showCategoryQuestions(selectedCategory);
                    }
                });
            });
        }

        // Show all questions from a category
        function showCategoryQuestions(category) {
            if (!category) {
                document.getElementById('faqContainer').innerHTML = `<div class="no-results" data-i18n="faq.selectCategory">${t('faq.selectCategory')}</div>`;
                return;
            }
            
            const questions = faqData.filter(item => item.category === category);
            renderResults(questions.map(q => ({ ...q, score: 1 })));
        }

        // Render suggestions
        function renderSuggestions() {
            const container = document.getElementById('suggestions');
            container.innerHTML = suggestions.map(s =>
                `<button class="suggestion-chip" onclick="searchFromSuggestion('${s.text}')" data-i18n="faq.suggestions.${s.key}">${s.text}</button>`
            ).join('');
        }

        // Search from suggestion
        function searchFromSuggestion(query) {
            document.getElementById('searchInput').value = query;
            performSearch(query);
        }

        // Get category icon
        function getCategoryIcon(categoryName) {
            const cat = categories.find(c => c.name === categoryName);
            return cat ? cat.icon : '📋';
        }

        // Render FAQ results
        function renderResults(results) {
            const container = document.getElementById('faqContainer');
            
            if (results.length === 0) {
                container.innerHTML = `<div class="no-results" data-i18n="faq.noMatches">${t('faq.noMatches')}</div>`;
                document.getElementById('matchedResults').textContent = '0';
                return;
            }
            
            document.getElementById('matchedResults').textContent = results.length;
            
            container.innerHTML = results.map((item, index) => `
                <div class="faq-item ${item.score > 0.8 ? 'highlighted' : ''}" data-index="${index}">
                    <div class="faq-header">
                        <div class="faq-question">
                            <span>${item.question}</span>
                        </div>
                        <div class="faq-meta">
                            <div class="category-badge">
                                <span class="category-badge-icon">${getCategoryIcon(item.category)}</span>
                                ${(() => {
                                    const cat = categories.find(c => c.name === item.category);
                                    const key = cat ? `faq.categories.${cat.key}` : '';
                                    return `<span ${key ? `data-i18n="${key}"` : ''}>${t(key, item.category)}</span>`;
                                })()}
                            </div>
                            ${item.score < 1 ? `<span class="match-score">⭐ ${Math.round(item.score * 100)}% ${t('faq.match','match')}</span>` : ''}
                        </div>
                        <span class="expand-icon">▼</span>
                    </div>
                    <div class="faq-answer">
                        <div class="faq-answer-content">
                            <div class="answer-highlight" data-i18n="faq.answer">Answer</div>
                            ${item.answer}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add click handlers for expand/collapse
            container.querySelectorAll('.faq-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A' || e.target.tagName === 'BUTTON') return;
                    
                    const answer = item.querySelector('.faq-answer');
                    const icon = item.querySelector('.expand-icon');
                    
                    // Close all other items
                    container.querySelectorAll('.faq-item').forEach(otherItem => {
                        if (otherItem !== item) {
                            otherItem.querySelector('.faq-answer').classList.remove('open');
                            otherItem.querySelector('.expand-icon').classList.remove('open');
                        }
                    });
                    
                    // Toggle current item
                    answer.classList.toggle('open');
                    icon.classList.toggle('open');
                });
            });
        }

        // Perform search
        function performSearch(query) {
            currentResults = searchFAQ(query, selectedCategory);
            renderResults(currentResults);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderCategories();
            renderSuggestions();
            
            // Set up search input
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300);
            });
            
            // Update stats
            document.getElementById('totalQuestions').textContent = faqData.length;
        });
    </script>
</body>
</html>

